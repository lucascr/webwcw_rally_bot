<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* Responsive layout - makes the menu and the content stack on top of each other */
    @media (max-width: 600px) {
      .column {
        width: 100%;
      }
    }
    /* Style the response */
    #loginresponse {
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ddd;
      background-color: #f9f9f9;
    }
    #logo {
      display: block;
      margin-left: auto;
      margin-right: auto;
      width: 300px;
    }
  </style>
    <title>Rally Studios BOT Registration</title>
    <img id="logo" src="rslogo.jpg" alt="Logo">
    <script src="wax.js"></script>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-8N4S1TTBZ4"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-8N4S1TTBZ4');
    </script>
  </head>
  <body>
    <h1>WAX All Access Cloud Wallet Login</h1>
    <h2>Please login using your WAX Cloud Wallet to register on the Rally </h2>
    <script>  
    window.onload = function() {
      function load_wax(){
      let params = new URLSearchParams(window.location.search);
      let param_uid = params.get('uid'); // "value uid"
      console.log("UID: "+param_uid);

      // Set the value of the uid input field
      document.getElementById('tbot_uid').value = param_uid;
    }
    load_wax();
    };
  const wax = new waxjs.WaxJS({
      rpcEndpoint: 'https://wax.greymass.com',
    });
    //automatically check for credentials autoLogin(); 
    //checks if autologin is available 
    async function login()
    { 
      try { //if autologged in, this simply returns the userAccount w/no popup 
        let userAccount = await wax.login(); 
        document.getElementById('tbot_userAccount').value = userAccount;
        document.getElementById('tbot_myForm').submit();
        //let pubKeys = wax.pubKeys; 
        //let str = 'Account: ' + userAccount + 'Active: ' + pubKeys[0] + 'Owner: ' + pubKeys[1] ;
        //document.getElementById('loginresponse').insertAdjacentHTML('beforeend', str);
      } catch (e) {
        document.getElementById('loginresponse').append(e.message);
      } 
    }
    </script>
    <div id="loginresponse"></div>
    <form id="tbot_myForm" action="https://socialymas.com/clientes/rallystudios/tbot.php" method="post">
      <input type="hidden" id="tbot_userAccount" name="tbot_userAccount" value="">
      <input type="hidden" id="tbot_uid" name="tbot_uid" value="">
      <button type="button" onclick="login()">Login with WAX All Access Cloud Wallet</button>
    </form>
  </body>
</html>
